# 로깅 시스템 문서

## 개요
AI 기술테크포럼 2024 웹어플리케이션의 포괄적인 로깅 시스템입니다. 모든 요청, 처리 과정, 에러를 추적하여 시스템 모니터링과 디버깅을 용이하게 합니다.

## 로깅 아키텍처

### 로깅 라이브러리
- **Winston**: 메인 로깅 라이브러리
- **Morgan**: HTTP 요청 로깅
- **Custom Middleware**: 커스텀 로깅 미들웨어

### 로그 레벨
- `error`: 에러 및 예외 상황
- `warn`: 경고 및 주의사항
- `info`: 일반적인 정보
- `http`: HTTP 요청/응답
- `debug`: 디버깅 정보

## 로그 파일 구조

```
logs/
├── error.log      # 에러 로그 (레벨: error)
├── combined.log   # 전체 로그 (모든 레벨)
└── http.log       # HTTP 요청 로그 (레벨: http)
```

## 로깅 범위

### 1. 요청/응답 로깅
- 모든 HTTP 요청과 응답
- 요청 ID를 통한 추적
- 응답 시간 측정
- 클라이언트 IP 및 User-Agent

### 2. 인증 로깅
- 로그인 시도 (성공/실패)
- 토큰 검증
- 로그아웃
- 관리자 활동

### 3. 데이터베이스 로깅
- 모든 SQL 쿼리 실행
- 쿼리 실행 시간
- 데이터베이스 에러

### 4. 이벤트 로깅
- 이벤트 참여 현황
- QR 코드 생성
- 경품 자격 부여
- 설문조사 참여

### 5. 관리자 활동 로깅
- 관리자 로그인
- 데이터 접근
- 관리 작업 수행

## 로그 포맷

### JSON 포맷 (파일)
```json
{
  "timestamp": "2024-12-20 10:30:45",
  "level": "info",
  "message": "Authentication successful",
  "userId": 123,
  "employeeId": "EMP001",
  "ip": "192.168.1.100",
  "requestId": "abc123def",
  "service": "ai-tech-forum"
}
```

### 콘솔 포맷 (개발 환경)
```
2024-12-20 10:30:45 [info]: Authentication successful {"userId":123,"employeeId":"EMP001","ip":"192.168.1.100"}
```

## 로그 관리

### 자동 로그 관리
- 파일 크기 제한: 5MB
- 최대 파일 수: 5개 (로테이션)
- 자동 압축: 50MB 초과 시
- 자동 삭제: 30일 경과 시

### 로그 관리 명령어
```bash
# 로그 파일 정리
npm run logs:cleanup

# 로그 통계 생성
npm run logs:stats

# 에러 로그 분석
npm run logs:analyze

# 모든 로그 관리 작업 실행
npm run logs:all
```

## 로그 분석

### 1. 성능 분석
- API 응답 시간 추적
- 데이터베이스 쿼리 성능
- 메모리 사용량 모니터링

### 2. 보안 분석
- 실패한 로그인 시도
- 의심스러운 활동 패턴
- IP 기반 접근 분석

### 3. 사용자 행동 분석
- 이벤트 참여 패턴
- 기능 사용 통계
- 에러 발생 빈도

## 모니터링 지표

### 주요 지표
- **응답 시간**: API 평균 응답 시간
- **에러율**: 에러 발생 비율
- **사용자 활동**: 활성 사용자 수
- **데이터베이스 성능**: 쿼리 실행 시간

### 알림 설정
- 에러율 임계값 초과
- 응답 시간 임계값 초과
- 데이터베이스 연결 실패
- 메모리 사용량 임계값 초과

## 로그 보안

### 민감 정보 보호
- 비밀번호 해시화
- 토큰 마스킹
- 개인정보 암호화
- 로그 접근 권한 관리

### 로그 보존 정책
- 에러 로그: 90일 보존
- 일반 로그: 30일 보존
- HTTP 로그: 7일 보존
- 압축된 로그: 1년 보존

## 디버깅 가이드

### 1. 요청 추적
```bash
# 특정 요청 ID로 검색
grep "requestId.*abc123def" logs/combined.log
```

### 2. 에러 분석
```bash
# 에러 로그만 확인
tail -f logs/error.log
```

### 3. 성능 분석
```bash
# 응답 시간이 긴 요청 찾기
grep "duration.*[5-9][0-9][0-9]ms" logs/combined.log
```

### 4. 사용자 활동 추적
```bash
# 특정 사용자 활동 추적
grep "userId.*123" logs/combined.log
```

## 로그 레벨 설정

### 환경별 설정
```bash
# 개발 환경
LOG_LEVEL=debug

# 프로덕션 환경
LOG_LEVEL=info

# 디버깅 모드
LOG_LEVEL=debug
```

## 성능 최적화

### 로그 성능 최적화
- 비동기 로깅
- 로그 버퍼링
- 배치 처리
- 압축 최적화

### 모니터링 성능
- 로그 샘플링
- 집계 처리
- 인덱싱 최적화
- 캐싱 활용

## 문제 해결

### 일반적인 문제
1. **로그 파일이 너무 큼**: 자동 로테이션 확인
2. **디스크 공간 부족**: 로그 정리 실행
3. **성능 저하**: 로그 레벨 조정
4. **로그 누락**: 권한 및 경로 확인

### 디버깅 체크리스트
- [ ] 로그 파일 권한 확인
- [ ] 디스크 공간 확인
- [ ] 로그 레벨 설정 확인
- [ ] 네트워크 연결 확인
- [ ] 데이터베이스 연결 확인

## 향후 개선 계획

### 단기 계획
- 실시간 로그 모니터링
- 자동 알림 시스템
- 로그 시각화 대시보드

### 장기 계획
- 머신러닝 기반 이상 탐지
- 분산 로깅 시스템
- 클라우드 로그 분석
- 자동화된 문제 해결

---

**참고**: 이 로깅 시스템은 시스템의 안정성과 성능을 보장하기 위해 지속적으로 모니터링하고 개선되어야 합니다.
